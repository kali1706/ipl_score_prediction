<!DOCTYPE html>
<html>
<head>
    <title>IPL Score Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/team-logos.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
</head>
<body>
    <div class="container animate__animated animate__fadeIn">
        <div class="header">
            <h1 class="text-center my-4 animate__animated animate__pulse"><i class="fas fa-cricket fa-sm me-2"></i>IPL Score Predictor</h1>
        </div>
        
        {% if error %}
        <div class="alert alert-danger animate__animated animate__shakeX">{{ error }}</div>
        {% endif %}
        
        <form action="{{ url_for('predict') }}" method="POST" class="needs-validation" novalidate>
            <div class="form-section innings-section animate__animated animate__fadeInUp">
                <h3 class="section-title"><i class="fas fa-flag me-2"></i>Match Information</h3>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="innings">Select Innings</label>
                            <select class="form-control" id="innings" name="innings" required>
                                <option value="first">First Innings</option>
                                <option value="second">Second Innings</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group" id="targetScoreContainer" style="display: none;">
                            <label for="target">Target Score</label>
                            <input type="number" class="form-control" id="target" name="target" min="0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section teams-section">
                <h3 class="section-title"><i class="fas fa-users me-2"></i>Team Selection</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="batting-team">Batting Team</label>
                            <select class="form-control" id="batting-team" name="batting-team" required>
                                {% for team in teams %}
                                <option value="{{ team }}">{{ team }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="bowling-team">Bowling Team</label>
                            <select class="form-control" id="bowling-team" name="bowling-team" required>
                                {% for team in teams %}
                                <option value="{{ team }}">{{ team }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Team details section -->
                <div class="team-details mt-4">
                    <div class="team-box batting-details">
                        <h3>Batting Team</h3>
                        <div class="team-logo-container">
                            <img id="battingTeamLogo" class="team-logo" src="" alt="Batting Team">
                        </div>
                        <div class="team-name" id="battingTeamName"></div>
                        <div class="team-stats" id="battingTeamStats">
                        </div>
                    </div>
                    
                    <div class="vs-container">
                        <div class="vs-circle">
                            <span class="vs-text">VS</span>
                        </div>
                        <div class="total-matches" id="totalMatches">
                        </div>
                    </div>
                    
                    <div class="team-box bowling-details">
                        <h3>Bowling Team</h3>
                        <div class="team-logo-container">
                            <img id="bowlingTeamLogo" class="team-logo" src="" alt="Bowling Team">
                        </div>
                        <div class="team-name" id="bowlingTeamName"></div>
                        <div class="team-stats" id="bowlingTeamStats">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section venue-section">
                <h3 class="section-title"><i class="fas fa-map-marker-alt me-2"></i>Venue</h3>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="city">Select Venue</label>
                            <select class="form-control" id="city" name="city" required>
                                {% for venue in venues %}
                                <option value="{{ venue }}">{{ venue }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section score-section">
                <h3 class="section-title"><i class="fas fa-chart-line me-2"></i>Current Score</h3>
                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="current-score">Runs</label>
                            <input type="number" class="form-control" id="current-score" name="current-score" required min="0">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="wickets">Wickets</label>
                            <input type="number" class="form-control" id="wickets" name="wickets" required min="0" max="10">
                            <div class="form-text text-light">Maximum 10 wickets</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="overs">Overs</label>
                            <input type="number" class="form-control" id="overs" name="overs" required min="0" max="20" step="0.1">
                            <div class="form-text text-light">Format: 16.3 (16 overs and 3 balls)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section recent-performance">
                <h3 class="section-title"><i class="fas fa-history me-2"></i>Recent Performance</h3>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="last-five">Runs scored in last 5 overs</label>
                            <input type="number" class="form-control" id="last-five" name="last-five" min="0" value="0">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="last-five-wickets">Wickets fallen in last 5 overs</label>
                            <input type="number" class="form-control" id="last-five-wickets" name="last-five-wickets" min="0" max="10" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit button -->
            <div class="row mt-4">
                <div class="col-12">
                    <button type="submit" class="btn btn-primary btn-lg btn-block w-100" id="predictButton">
                        <i class="fas fa-calculator me-2"></i>Predict Score & Win Probability
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <script>
        // Show/hide target score field based on innings selection
        document.getElementById('innings').addEventListener('change', function() {
            const targetContainer = document.getElementById('targetScoreContainer');
            if (this.value === 'second') {
                targetContainer.style.display = 'block';
            } else {
                targetContainer.style.display = 'none';
            }
        });
        
        // Update team logos when teams are selected
        document.getElementById('batting-team').addEventListener('change', function() {
            updateTeamDetails('batting');
        });
        
        document.getElementById('bowling-team').addEventListener('change', function() {
            updateTeamDetails('bowling');
        });
        
        // Function to update team details (logo and name)
        async function updateTeamDetails(teamType) {
            const teamSelect = document.getElementById(teamType + '-team');
            const teamName = teamSelect.value;
            const teamNameDisplay = document.getElementById(teamType + 'TeamName');
            const teamLogo = document.getElementById(teamType + 'TeamLogo');
            
            // Update team name
            teamNameDisplay.textContent = teamName;
            
            // Update team logo
            const teamLogos = {
                'Sunrisers Hyderabad': '/static/images/teams/srh.jpg',
                'Mumbai Indians': '/static/images/teams/mi.jpg',
                'Royal Challengers Bangalore': '/static/images/teams/rcb.jpg',
                'Chennai Super Kings': '/static/images/teams/csk.jpg',
                'Kolkata Knight Riders': '/static/images/teams/kkr.jpg',
                'Kings XI Punjab': '/static/images/teams/pbks.jpg',
                'Delhi Capitals': '/static/images/teams/dc.jpg',
                'Rajasthan Royals': '/static/images/teams/rr.jpg',
                'Gujarat Titans': '/static/images/teams/gt.jpg',
                'Lucknow Super Giants': '/static/images/teams/lsg.jpg'
            };
            
            if (teamName in teamLogos) {
                teamLogo.src = teamLogos[teamName];
                teamLogo.style.display = 'block';
                teamLogo.classList.remove('logo-animation');
                void teamLogo.offsetWidth;
                teamLogo.classList.add('logo-animation');
            }
            
            // Update head-to-head stats
            updateHeadToHeadStats();
        }
        
        // Function to update head-to-head statistics
        async function updateHeadToHeadStats() {
            const battingTeam = document.getElementById('batting-team').value;
            const bowlingTeam = document.getElementById('bowling-team').value;
            
            try {
                const response = await fetch('/get_head_to_head_stats', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        team1: battingTeam,
                        team2: bowlingTeam
                    })
                });
                
                const stats = await response.json();
                
                // Update stats display
                document.getElementById('battingTeamWins').textContent = stats.team1_wins;
                document.getElementById('battingTeamWinRate').textContent = stats.team1_win_percentage + '%';
                document.getElementById('bowlingTeamWins').textContent = stats.team2_wins;
                document.getElementById('bowlingTeamWinRate').textContent = stats.team2_win_percentage + '%';
                document.getElementById('totalMatches').textContent = `Total Matches: ${stats.total_matches}`;
                
            } catch (error) {
                console.error('Error fetching head-to-head stats:', error);
            }
        }
        
        // Add event listeners for team selection changes
        document.getElementById('batting-team').addEventListener('change', () => updateTeamDetails('batting'));
        document.getElementById('bowling-team').addEventListener('change', () => updateTeamDetails('bowling'));
        
        // Initialize team details on page load
        window.addEventListener('DOMContentLoaded', function() {
            updateTeamDetails('batting');
            updateTeamDetails('bowling');
        });
    </script>
</body>
</html>